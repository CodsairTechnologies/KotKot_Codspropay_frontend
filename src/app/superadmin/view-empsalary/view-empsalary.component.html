<div class="main" id="main">

    <div class="row first-row align-items-center">
        <!-- breadcrumbs -->
        <div class="col-lg-8 col-md-7 col-12 mb-2 mb-md-0">
            <div class="breadcrumb">
                <span class="home-icon"><i class="bi bi-house-door-fill"></i></span>
                <a routerLink="/superadmin/dashboard" class="breadcrumb-item">Dashboard</a> &nbsp; <i
                    class="bi bi-chevron-right"></i> &nbsp;
                <a routerLink="/superadmin/view-monthlysalary" class="breadcrumb-item">View Employee Salary</a>
                &nbsp; <i class="bi bi-chevron-right"></i> &nbsp;
                <a routerLink="/superadmin/view-empsalary" class="breadcrumb-item">View Monthly Employee Salary</a>

            </div>
        </div>

        <!-- breadcrumbs -->


        <div class="col-lg-2 col-md-3 col-6 mb-2 mb-md-0 d-flex justify-content-md-start justify-content-center">

            <!-- <button class="bttn-file" type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop" >
                Upload Inc. File 
            </button> -->

        </div>

        <div class="col-lg-2 col-md-3 col-6 mb-2 mb-md-0 d-flex justify-content-md-start justify-content-center">
            <div class="dropdown filter">
                <button class="bttn" type="button" (click)="toggleInputRow()">
                    Filter <i class="bi bi-funnel-fill"></i>
                </button>
            </div>
        </div>




        <div class="row" *ngIf="showInputRow">
            <div class="mb-3 filter-body">
                <form [formGroup]="SalaryFilterForm">
                    <div class="row align-items-end">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label for="Search" class="form-label">Search</label>
                            <input type="text" class="form-control" id="search" placeholder="Enter employee ID"
                                formControlName="search" (change)="inputchange($event)">
                        </div>

                        <div class="col-lg-1 col-md-6 mb-3">
                            <label class="form-label d-block invisible">Search</label>
                            <button class="filter-search1 w-100" (click)="get_salarytableFn()"><i
                                    class="bi bi-search"></i></button>
                        </div>

                        <div class="col-lg-3 col-md-6 mb-3">
                            <label for="Department" class="form-label">Department</label>
                            <select class="form-select" formControlName="Department"
                                (change)="selectedDepartment($event)">
                                <option value="" disabled selected>Select Department</option>
                                <option [value]="dept['id']" *ngFor="let dept of departmentlist">
                                    {{ dept['departmentname'] }}
                                </option>
                            </select>
                        </div>

                        <div class="col-lg-2 col-md-6 mb-3">
                            <label for="Role" class="form-label">Role</label>
                            <select class="form-select" formControlName="Role">
                                <option value="" disabled selected>Select Role</option>
                                <option value="Staff">Staff</option>
                                <option value="Office Staff">Office Staff</option>
                            </select>
                        </div>

                        <div class="col-lg-1 col-md-6 mb-3">
                            <label class="form-label d-block invisible">Filter</label>
                            <button class="filter-search w-100" (click)="get_salarytableFn()"><i
                                    class="bi bi-funnel-fill"></i></button>
                        </div>
                    </div>



                </form>

            </div>
        </div>



    </div>

    <div class="box">

        <div class="table-container">
            <div class="table-scrollable table-responsive">
                <table class="table table-striped  table-custom-spacing">
                    <thead class="sticky-header">
                        <tr class="text-center">
                            <!-- Header cells -->
                            <th class="fixed-col" scope="col">SlNo</th>
                            <th class="fixed-col" scope="col">Month</th>
                            <th class="fixed-col" scope="col">Emp ID</th>
                            <th class="fixed-col last-fixed-col" scope="col">Name</th>

                            <th scope="col">Role</th>
                            <th scope="col">Salary Type</th>

                            <th scope="col">Company</th>
                            <th scope="col">Department</th>
                            <th scope="col">Basic Salary</th>
                            <th scope="col">Working Days</th>
                            <th scope="col">Tot working hours</th>

                            <th scope="col">Basic + da</th>
                            <th scope="col">DA</th>
                            <th scope="col">HRA</th>
                            <th scope="col">TA</th>
                            <th scope="col">Tot ot</th>

                            <th scope="col">Ot Earnings</th>
                            <th scope="col">LOP</th>
                            <th scope="col">Fine</th>
                            <th scope="col">Total Deduction</th>
                            <th scope="col">Incentive</th>
                            <th scope="col">Paid Salary</th>
                            <th scope="col">Holidayot earnings</th>
                            <th scope="col">holidayot</th>
                            <th scope="col">oldbalance</th>
                            <th scope="col">Tot. Earnings</th>
                            <th scope="col">Adv. Amount</th>
                            <th scope="col">EMI</th>
                            <th scope="col">PF</th>
                            <th scope="col">ESI</th>
                            <th scope="col">Salary</th>
                            <th scope="col">Withheld</th>
                            <th scope="col">Withheld Days</th>
                            <th scope="col">Actions</th>

                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of paginatedPaymentList; let i = index" class="text-center">
                            <!-- Body cells -->
                            <td class="fixed-col text-center">{{ i + 1 + (currentPage - 1) * itemsPerPage }}</td>
                            <td class="fixed-col">{{ item.month }}</td>
                            <td class="fixed-col">{{ item.empid }}</td>
                            <td class="fixed-col last-fixed-col">{{ item.name }}</td>

                            <td>{{ item.role }}</td>
                            <td>{{ item.salarytype }}</td>

                            <td>{{ item.unit }}</td>
                            <td>{{ item.department }}</td>
                            <td>{{ item.basicsalary }}</td>
                            <td>{{ item.workingdays }}</td>
                            <td>{{ item.workinghours }}</td>

                            <td>{{ item.total_ot }}</td>
                            <td>{{ item.basicda }}</td>
                            <td>{{ item.da }}</td>
                            <td>{{ item.hra }}</td>
                            <td>{{ item.ta }}</td>
                            <td>{{ item.ot_earnings }}</td>
                            <td>{{ item.lop }}</td>
                            <td>{{ item.fine }}</td>
                            <td>{{ item.totaldeduction }}</td>
                            <td>{{ item.incentive }}</td>
                            <td>{{ item.paidsalary }}</td>
                            <td>{{ item.holidayot_earnings }}</td>
                            <td>{{ item.holidayot }}</td>
                            <td>{{ item.oldbalance }}</td>
                            <td>{{ item.total_earnings }}</td>
                            <td>{{ item.advancesalaryamount }}</td>
                            <td>{{ item.emi }}</td>
                            <td>{{ item.pf }}</td>
                            <td>{{ item.esi }}</td>
                            <td>{{ item.salary }}</td>
                            <td>{{ item.iswithheld }}</td>
                            <td>{{ item.withhelddays }}</td>
                            <td>
                                <!-- Delete Icon -->
                                <i class="bi bi-trash-fill delete-icon" data-bs-placement="bottom" title="Delete"
                                    (click)="setSelectedItem(item)" data-bs-toggle="modal"
                                    data-bs-target="#verticalycenter"></i>

                                <div *ngIf="item.iswithheld === 'Yes'" (click)="setSelectedItem(item)"
                                    data-bs-toggle="modal" data-bs-target="#paySalaryModal" class="pay-salary-box">
                                    Pay Salary
                                </div>







                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>



        <div style="text-align: right;">
            <p-paginator [rows]="itemsPerPage" [totalRecords]="Salary_ArrayList.length"
                [rowsPerPageOptions]="itemsPerPageOptions" (onPageChange)="onPageChange($event)"
                [dropdownAppendTo]="'body'"></p-paginator>
        </div>
    </div>
</div>





<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Edit Salary</h5>
                <button type="button" class="btn-close me-3" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="InventivesForm">



                    <div class="mb-3">
                        <label for="overtime-file" class="form-label">Incentive File</label>
                        <div class="file-upload card">
                            <div class="upload-container">
                                <span id="incentive-file-name">No file selected</span>
                                <label for="fileUpload2" class="custom-file-upload">
                                    Choose
                                    <input type="file" id="fileUpload2" (change)="onFileSelected($event)"
                                        formControlName="Incentives">
                                </label>
                            </div>
                        </div>
                    </div>


                    <div class="mb-3 text-end">
                        <button type="button" class="bttn w-25" (click)="uploadFile()">Upload</button>

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>





<!-- Modal for delete -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel"><i
                        class="bi bi-exclamation-triangle-fill text-danger fs-4"></i> &nbsp; Delete Salary?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">

                    <div class="col-10 text-center">
                        <p>Are you sure you want to delete this salary?</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer ">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger" (click)="deleteSalaryFn()"
                    data-bs-dismiss="modal">Delete</button>
            </div>
        </div>
    </div>
</div>


<!-- Pay Salary Modal -->
<div class="modal fade" id="paySalaryModal" tabindex="-1" aria-labelledby="paySalaryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="paySalaryModalLabel">Pay Salary</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to pay salary to <strong>{{ selectedItem?.name }}</strong> ({{ selectedItem?.empid
                }})?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="bttnn" (click)="confirmPaySalary()">Confirm</button>
            </div>
        </div>
    </div>
</div>


<!-- modal for delete salary -->

<div class="modal fade" id="verticalycenter" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"> Delete Employee Salary </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="col-12">
                        <h5 class="text-center mb-4">Are you sure you want to delete this salary?</h5>
                    </div>
                    <div class="text-center">
                        <button type="button" class="btn btn-danger" (click)="deleteSalary(selectedItem)"
                            data-bs-dismiss="modal">Delete</button>
                        &nbsp;&nbsp;
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>





<!-- EDit incentive -->

<div class="modal fade" id="incentivemodal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Edit Salary</h5>
                <button type="button" class="btn-close me-3" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="editSalaryForm">


                    <div class="mb-3 email">
                        <label for="PerformanceIncentives" class="form-label">Performance Incentives</label>
                        <input type="text" class="form-control" id="PerformanceIncentives"
                            placeholder="Enter Performance Incentives" formControlName="PerformanceIncentives">

                        <div class="error-msg2"
                            *ngIf="editSalaryForm.get('PerformanceIncentives')?.errors && editSalaryForm.get('PerformanceIncentives')?.touched">
                            <p>Performance Incentives is required!</p>
                        </div>
                    </div>

                    <div class="mb-3 email">
                        <label for="OtherIncentives" class="form-label">Other Incentives</label>
                        <input type="text" class="form-control" id="OtherIncentives"
                            placeholder="Enter Other Incentives" formControlName="OtherIncentives">

                        <div class="error-msg2"
                            *ngIf="editSalaryForm.get('OtherIncentives')?.errors && editSalaryForm.get('OtherIncentives')?.touched">
                            <p>Other Incentives is required!</p>
                        </div>
                    </div>



                    <div class="mb-3 email">
                        <label for="NightAllowance" class="form-label">Night Allowance</label>
                        <input type="text" class="form-control" id="NightAllowance" placeholder="Enter Night Allowance"
                            formControlName="NightAllowance">

                        <div class="error-msg2"
                            *ngIf="editSalaryForm.get('NightAllowance')?.errors && editSalaryForm.get('NightAllowance')?.touched">
                            <p>Night Allowance is required!</p>
                        </div>
                    </div>


                    <div class="mb-3 text-end">
                        <button type="button" class="bttn w-25" (click)="editSalaryFn()">Update</button>

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>






<div *ngIf="Loader" class="spinner-container">
    <div class="spinner"></div>
</div>